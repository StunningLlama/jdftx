<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>JDFTx: Test compiled executable</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="jdftx-55.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">JDFTx
   &#160;<span id="projectnumber">1.7.0</span>
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.svg"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('Testing.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Test compiled executable </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>After building, in the build directory, run </p><pre class="fragment">make test
</pre><p> to check that the code runs correctly.</p>
<p>If all the tests fail immediately, then the executables are not able to start, likely due to a runtime library path issue. Run ./jdftx to check the specific error messages; if it is a library path issue, use 'ldd ./jdftx' to identify all the missing libraries.</p>
<p>If the tests take a while, but then some or all of them fail, most likely one of the linked libraries is behaving inconsistently. Try linking to alternate BLAS, LAPACK and FFT libraries, if possible. If you linked to MKL and found tests that fail, try using ForceFFTW, and if it still doesn't work, try using ThreadedBlas=no. (See <a class="el" href="Customization.html">Customization</a> for more details.)</p>
<p>If all the tests pass in the serial mode above, then you can test it with MPI using: </p><pre class="fragment">make testclean
export JDFTX_LAUNCH="mpirun -n %d"
make test
</pre><p> This will invoke each test with a different optimal number of MPI processes (in range 1 - 4) on the same machine. (See <a class="el" href="GettingStarted.html">Getting started</a> for more details on running the code with MPI.) If any of these tests fail, check the MPI installation or try compiling with an alternate MPI, if possible.</p>
<p>Next, if you compiled with CUDA and have a GPU available, try: </p><pre class="fragment">make testclean
export JDFTX_LAUNCH=""   #disable MPI (not needed if you have 4 GPUs)
export JDFTX_SUFFIX="_gpu"
make test
</pre><p> If you encounter issues with the GPU test, try different CUDA compilation flags or a newer CUDA version, if appropriate.</p>
<p>If the tests work, then make sure the performance is reasonable. Here are some approximate timings (all tests in the latest JDFTx combined) on selected hardware to serve as a guide:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">Hardware   </th><th class="markdownTableHeadRight">Total time    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">4-core laptop (i7-3632QM)   </td><td class="markdownTableBodyRight">800 s    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">16-core workstation (2x E5-2620)   </td><td class="markdownTableBodyRight">400 s    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">Tesla K80: one GPU (without MPI)   </td><td class="markdownTableBodyRight">250 s   </td></tr>
</table>
<p>If the tests run substantially slower on comparable hardware and you compiled with MPI (even if you didn't issue mpirun explicitly), a very likely cause is CPU binding of threads imposed by MPI: try passing "--bind-to none" to mpirun (for OpenMPI). Also check whether linking to alternate BLAS and FFT libraries improves performance. Note that MPI will not likely speed up the test calculations much (or at all) on a single computer because JDFTx already parallelizes aggressively using pthreads to use all cores of the machine; just make sure that it does not slow down by more than 20 - 30%.</p>
<p>The run time on Windows/Cygwin will be substantially slower, and there is no easy fix (in the JDFTx compilation anyway). </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
</div>
</body>
</html>
