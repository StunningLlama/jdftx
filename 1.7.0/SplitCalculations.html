<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>JDFTx: Splitting phonon calculations</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="jdftx-55.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">JDFTx
   &#160;<span id="projectnumber">1.7.0</span>
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.svg"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('SplitCalculations.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Splitting phonon calculations </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><div class="image">
<img src="PhononDispersionGraphene.png" alt=""/>
</div>
<p>The previous tutorial introduced phonon dispersion calculations using the example of silicon using a small 2x2x2 supercell. Realistic phonon calculations typically require at least 4x4x4 supercells for bulk 3D materials, and 6x6x1 supercells for 2D materials like graphene. Large supercells quickly make phonon calculations extremely expensive. This tutorial shows how to split a phonon calculation into smaller chunks, which can be efficiently run in parallel.</p>
<p>Let's start with the graphene calculations from the <a class="el" href="TwoDmaterials.html">Two-dimensional materials</a> tutorial. First, we need to make sure the unit cell calculation saves its state: </p><pre class="fragment">#Save the following to totalE.in:
include common.in
kpoint-folding 12 12 1
elec-smearing Fermi 0.01
dump-name totalE.$VAR
dump End ElecDensity State
</pre><p> which can be run with "mpirun -n 4 jdftx -i totalE.in | tee totalE.out". Also make sure that the k-point paths and plot script for band structure have been generated as described in the <a class="el" href="TwoDmaterials.html">Two-dimensional materials</a> tutorial.</p>
<p>Now, set up the phonon input file, admittedly still with an inadequately small supercell size, to facilitate a quick test: </p><pre class="fragment">#Save the following to phonon.in:
include totalE.in
initial-state totalE.$VAR
dump-only

phonon supercell 2 2 1 ${phononParams}
</pre><p> We will replace phononParams using environment variables to run the phonon code in various modes; alternatively, you could create separate input files for each stage.</p>
<p>First, perform a phonon dry run using: </p><pre class="fragment">phonon -ni phonon.in
</pre><p> and examine the output. The output is very similar to the previous tutorial, except that in the dry run, electronic optimizations and file outputs are skipped. Additionally, at the end, the code reports a summary of the supercell calculations necessary: </p><pre class="fragment">Parameter summary for supercell calculations:
    Perturbation: 1  nStates: 7
    Perturbation: 2  nStates: 20
Use option iPerturbation of command phonon to run each supercell calculation separately.
</pre><p> This time there are two symmetry-irreducible perturbations (C atom displaced in plane, and out of plane) which have different symmetries and hence different numbers of reduced k points (nStates).</p>
<p>Now, we can run the two supercell calculations separately using: </p><pre class="fragment">export phononParams="iPerturbation 1"
mpirun -n 4 phonon -i phonon.in | tee phonon.1.out
</pre><p> and </p><pre class="fragment">export phononParams="iPerturbation 2"
mpirun -n 4 phonon -i phonon.in | tee phonon.2.out
</pre><p> I used 4 processes here for the four cores in my laptop. If running on a compute cluster, it would instead make sense to run the first calculation with 7 processes and the second with 20 (or 10 or 5) in order to get best parallel efficiency. Additionally, the two calculations can be launched on separate (sets of) nodes concurrently.</p>
<p>Examine the two output files. Each runs only one of the two supercell calculations and saves the corresponding outputs (eg. totalE.phonon.1.dforces), but does not output the cell map, force matrix or free energies.</p>
<p>Finally, run: </p><pre class="fragment">export phononParams="collectPerturbations"
mpirun -n 4 phonon -i phonon.in | tee phonon.out
</pre><p> which reads the output from the previous calculations, puts it all together and outputs the cell map, force matrix and free energies. Using the python script from the previous tutorial produces the phonon dispersion shown at the top of the page.</p>
<p>Exercise: using a compute cluster, run the realistic 6x6x1 supercell version, making sure to pick the optimum parallelization for each supercell calculation, based on the dry run summary (and the hardware configuration of your cluster). How do the results compare with the quick test here? </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
</div>
</body>
</html>
