<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>JDFTx: Fixed-potential calculations</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="jdftx-55.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">JDFTx
   &#160;<span id="projectnumber">1.7.0</span>
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.svg"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('FixedPotential.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Fixed-potential calculations </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><center><table border="0">
<tr>
<td><div class="image">
<img src="ChargedSurfaceMinus.png" alt=""/>
<div class="caption">
&#160; </div></div>
 </td><td><div class="image">
<img src="ChargedSurfacePlus.png" alt=""/>
<div class="caption">
&#160; </div></div>
 </td><td><div class="image">
<img src="ChargingCurve.png" alt=""/>
</div>
 </td></tr>
</table>
</center><p>The previous tutorials calculated properties of neutral surfaces in vacuum and solution. With continuum solvation models of electrolytes (solvent + ions), we can straightforwardly also treat charged surfaces in solution. This is particularly important for electrochemical systems, where the electrode surface is in electrical contact with an external circuit which sets the electron chemical potential (mu). The number of electrons equilibrates to the applied mu and will result in a charged surface, except for the special case when mu is the potential of zero charge (PZC).</p>
<p>The most basic charged surface calculation is identical to the previous tutorials, except for an <a class="el" href="CommandElecInitialCharge.html">elec-initial-charge</a> command that sets up a non-zero charge state. This tutorial will instead demonstrate fixed-potential calculations using the <a class="el" href="CommandTargetMu.html">target-mu</a> command, which directly sets the electron chemical potential and lets the electron number equilibrate, exactly as in electrochemical systems. Specifically, we will calculate the charge vs potential curve of the Pt(111) surface.</p>
<p>We can collect most of the commands including fluid into the common setup file: </p><pre class="fragment">#Save the following to common.in:
lattice Hexagonal 5.23966 36
ion Pt  0.333333 -0.333333 -0.237676   1
ion Pt -0.333333  0.333333 -0.118838   1
ion Pt  0.000000  0.000000  0.000000   1
ion Pt  0.333333 -0.333333  0.118838   1
ion Pt -0.333333  0.333333  0.237676   1

ion-species GBRV/$ID_pbesol.uspp
elec-ex-corr gga-PBEsol
elec-cutoff 20 100

coulomb-interaction Slab 001
coulomb-truncation-embed 0 0 0

kpoint-folding 12 12 1
elec-smearing Fermi 0.01

fluid LinearPCM
pcm-variant CANDLE
fluid-solvent H2O
fluid-cation Na+ 1.
fluid-anion F- 1.

dump-name common.$VAR      #This will overwrite outputs from successive runs
initial-state common.$VAR  #This will initialize from the preceding calculation
dump End State BoundCharge
</pre><p> Note that we have included the geometry here instead of in ionpos/lattice files since we plan to skip geometry optimization for expediency in this tutorial too.</p>
<p>Start with a neutral calculation (in non-adsorbing aqueous NaF electrolyte): </p><pre class="fragment">#Save the following to Neutral.in
include common.in
electronic-SCF
</pre><p> which we run as: </p><pre class="fragment">jdftx -i Neutral.in | tee Neutral.out
</pre><p> Next, we setup the fixed potential calculations using the input file: </p><pre class="fragment">#Save the following to Charged.in:
include common.in
electronic-minimize nIterations 200
target-mu ${mu}
</pre><p> Note that we have used the robust, but slower, minimization algorithm instead of SCF because the SCF algorithm does not reliably converge in fixed-potential mode (yet) due to a charge-sloshing instability between the system and the electron reservoir.</p>
<p>We will now run a sequence of fixed-potential calculations for mu varying from -1 to +1 eV relative to the neutral potential (PZC) of -0.2015 Hartrees (final mu from Neutral.out). </p><pre class="fragment">#!/bin/bash
for iMu in {-10..10}; do
    export mu="$(echo $iMu | awk '{printf("%.4f", -0.2015+0.1*$1/27.2114)}')"
    mpirun -n 4 jdftx -i Charged.in | tee Charged$mu.out
    mv common.nbound Charged$mu.nbound
done
</pre><p> Save the above to run.sh, , give execute permissions using "chmod +x run.sh", and execute using "./run.sh". This will take a while (~ 1 hour on a laptop)! Note that the first line within the for loop calculates the current mu value, and the last line moves the bound charge output before it is overwritten by the next run. Also note that the first calculation takes the longest because it needs to move from the neutral state by 1 eV to the end of the range. The intermediate calculations are quicker since they only shift the potential by 0.1 eV, and each calculation starts at the final state of the previous one (all stored in common.$VAR).</p>
<p>Examine one of the output files, say Charged-0.2382.out. Notice that the energy output is now called G, instead of F. This is the grand free energy, G = F - mu N, where N is the number of electrons (also check the energy components output at the end). G is the appropriate free energy that satisfies a variational theorem at fixed electron chemical potential and temperature, and no longer F, which was the appropriate free energy at fixed electron number and temperature. (Recall the discussion of F vs Etot in the <a class="el" href="Metals.html">Metals</a> tutorial.)</p>
<p>Next examine the bound charge distribution in the fluid for the two extremes of potential using: </p><pre class="fragment">createXSF Charged-0.2382.out Charged-0.2382.xsf Charged-0.2382.nbound
createXSF Charged-0.1648.out Charged-0.1648.xsf Charged-0.1648.nbound
</pre><p> We need to specify the full file name for the bound charge file, rather than just the suffix 'nbound', because we moved the file in our run script. Visualizing these XSF files in VESTA, you shoud see distributions as shown at the top of this page. Note that the bound charge density is closer and larger next to the negatively charged surface as compared to the positively charged one due to the charge-asymmetry of CANDLE, exactly as we saw before in the <a class="el" href="SolvationIon.html">Solvation of ions</a> tutorial.</p>
<p>Finally, we will extract the charging curve of the Pt(111) surface: </p><pre class="fragment">#!/bin/bash
for file in Charged*.out; do
    awk '/FillingsUpdate/ {mu=$3; N=$5} END {print mu, N}' "$file"
done
</pre><p> Save the above to collectResults.sh, give execute permissions using "chmod +x collectResults.sh", and execute using "./collectResults.sh | tee mu_N.dat". Note that the above script uses awk to extract the final mu and nElectrons from each calculation. We can plot the extracted results using gnuplot: </p><pre class="fragment">#Within an interactive gnuplot session:
A = 2*((5.23966*0.529e-8)**2)*sin(pi/3) #top+bottom surface area in cm^2
qe = -1.602e-13                         #electron charge in microCoulombs
mu0 = -0.2015                           #mu corresponding to PZC
N0 = 80                                 #Nelectrons in neutral surface
set xlabel "V - PZC [V]"
set ylabel "Charge [uC/cm^2]"
set xzeroaxis
set yzeroaxis
unset key
plot "mu_N.dat" u ((mu0-$1)*27.2114):(($2-N0)*qe/A) w l
</pre><p> We have switched units and sign conventions to those commonly used in electrochemistry. The resulting plot is shown at the top of this page: note the change in slope and magnitude of charge density upon crossing the neutral potential, again a result of the charge asymmetry in CANDLE. The average slopes correspond to a capacitance of roughly 10 uF/cm<sup>2</sup> on the positive side and 25 uF/cm<sup>2</sup> on the negative side.</p>
<p>Exercise: calculate and plot the derivative dN/dmu as a function of potential using a finite difference formula. This gives you the differential capacitance. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
</div>
</body>
</html>
