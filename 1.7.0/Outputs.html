<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>JDFTx: Output variables</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="jdftx-55.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">JDFTx
   &#160;<span id="projectnumber">1.7.0</span>
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.svg"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('Outputs.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Output variables </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><div class="image">
<img src="Orbitals.jpg" alt=""/>
</div>
<p>The previous tutorial introduced a basic calculation of a water molecule, and visualized one possible output: the electron density. This tutorial explores other possible outputs from the same calculation. It also discusses how to access the binary output files from Octave/MATLAB or Python/NumPy, which you can skip till later if/when you need to do custom postprocessing on JDFTx outputs.</p>
<p>Here's the same input file water.in as before, with the introductory comments removed, and with more output options requested: </p><pre class="fragment">lattice Cubic 10  #Alternate to explicitly specifying lattice vectors
elec-cutoff 20 100
ion-species GBRV/h_pbe.uspp
ion-species GBRV/o_pbe.uspp
coords-type cartesian     
ion O   0.00 0.00  0.00  0
ion H   0.00 1.13 +1.45  1
ion H   0.00 1.13 -1.45  1

dump-name water.$VAR              #Filename pattern for outputs

#Outputs every few electronic steps:
dump Electronic State        #The first parameter is when to dump, the remaining are what
dump-interval Electronic 5   #How often to dump; this requests every 5 electronic steps

#Output at the end:
dump End Ecomponents ElecDensity EigStats Vscloc Dtot RealSpaceWfns
</pre><p> Here we invoke the <a class="el" href="CommandDump.html">dump</a> command multiple times to request different quantities to be output at various stages of the calculation. The <a class="el" href="CommandDumpInterval.html">dump-interval</a> controls the interval at each type of calculation stage where output can be retrieved.</p>
<p>Now run </p><pre class="fragment">jdftx -i water.in | tee water.out
</pre><p> and examine water.out. Every 5 electronic steps, the calculation outputs State, which is the collection of all variables necessary to continue the calculation. In this case, that consists of wfns, the electronic wavefunctions (more precisely, Kohn-Sham orbitals) as can be seen in the repeated lines 'Dumping water.wfns ... done.'</p>
<p>After completing electronic minimization, the calculation dumps</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Filename   </th><th class="markdownTableHeadNone">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">water.Ecomponents   </td><td class="markdownTableBodyNone">Ecomponents (energy components)    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">water.eigStats   </td><td class="markdownTableBodyNone">EigStats (eigenvalue statistics)    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">water.n   </td><td class="markdownTableBodyNone">ElecDensity (electron density)    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">water.d_tot   </td><td class="markdownTableBodyNone">Dtot (which is the net electrostatic potential)    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">water.Vscloc   </td><td class="markdownTableBodyNone">Vscloc (which is the self-consistent Kohn-Sham potential)    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">water.wfns_0_x.rs   </td><td class="markdownTableBodyNone">with x=0,1,2,3 for RealSpaceWfns (real-space wave functions)   </td></tr>
</table>
<p>Examine water.Ecomponents. It contains the energy components printed in exactly the same format as the output file. The energy components reported in this case are</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Component   </th><th class="markdownTableHeadNone">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Eewald   </td><td class="markdownTableBodyNone">Ewald: nuclear-nuclear Coulomb energy    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">EH   </td><td class="markdownTableBodyNone">Hartree: electron-electron mean-field Coulomb energy    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Eloc   </td><td class="markdownTableBodyNone">Electron-nuclear interaction (local part of pseudopotential)    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Enl   </td><td class="markdownTableBodyNone">Electron-nuclear interaction (nonlocal part of pseudopotential)    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Exc   </td><td class="markdownTableBodyNone">Exchange-Correlation energy    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Exc_core   </td><td class="markdownTableBodyNone">Exchange-Correlation energy subtraction for core electrons    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">KE   </td><td class="markdownTableBodyNone">Kinetic energy of electrons    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Etot   </td><td class="markdownTableBodyNone">Total energy   </td></tr>
</table>
<p>Next look at water.eigStats (same content also reproduced in output file). It contains statistics of the Kohn-Sham eigenvalues such as the minimum and maximum, and the highest-occupied orbital (HOMO) energies. Some of the energies, such as the lowest-unoccupied orbital (LUMO) energy and electron chemical potential (mu) are reported as unavailable since the present calculation did not include any unoccupied states.</p>
<p>The remaining outputs are binary files containing the values of the corresponding quantities on a uniform grid, in this case on a 40 x 40 x 40 grid for the wavefunctions and a 48 x 48 x 48 grid for the remainder (see the lines starting with 'Chosen fftbox' in the initialization section of the output file).</p>
<p>Within the <a href="http://www.octave.org">Octave</a> or MATLAB commandline, we can examine the binary electron density file which contains the electron density n(r) at each grid point (in electrons/bohr<sup>3</sup> units) using: </p><pre class="fragment"> fp = fopen('water.n', 'rb');  %# read as a binary file
 n = fread(fp, 'double');      %# stored as double-precision floating point numbers
 %# n = swapbytes(n);          %# uncomment on big-endian machines; data is always stored litte-endian
 fclose(fp);

 S = [ 48 48 48 ];             %# grid dimensions (see output file)
 V = 1000;                     %# unit cell volume (see output file)
 dV = V / prod(S);
 Nelectrons = dV * sum(n)

 n = reshape(n,S)(:,:,1);      %# convert to 3D and extract yz slice
 n = circshift(n, S(1:2)/2);   %# shift molecule from origin to box center
 contour(n)
</pre><p> This should print Nelectrons = 8, the number of valence electrons in the calculation and then present a contour plot of the yz slice of the electron density. Note that Octave/MATLAB differ from C++ in the array ordering convention, so the first array dimension is z, the second is y and the final one is x. The circshift prevents the tearing of the molecule across the boundaries. (The big-endian fix only applies if you are working on a PowerPC architecture, such as the Bluegene supercomputer and very old Macs; this is very unlikely.)</p>
<p>Alternately, if you prefer Python/NumPy, you can achieve exactly the same result with: </p><pre class="fragment"> import numpy as np
 import matplotlib.pyplot as plt

 n = np.fromfile('water.n',   # read from binary file
           dtype=np.float64)  # as 64-bit (double-precision) floats
 #n = swapbytes(n)            # uncomment on big-endian machines; data is always stored litte-endian

 S = [48,48,48]               # grid dimensions (see output file)
 V = 1000.0                   # unit cell volume (see output file)
 dV = V / np.prod(S)
 print "Nelectrons = ", dV * np.sum(n)

 n = n.reshape(S)[0,:,:]        # convert to 3D and extract yz slice
 n = np.roll(n, S[1]/2, axis=0) # shift molecule from origin to box center (along y)
 n = np.roll(n, S[2]/2, axis=1) # shift molecule from origin to box center (along z)
 plt.contour(n)
 plt.show()
</pre><p> The only difference here is that the default data order in NumPy is the same as C++.</p>
<p>The above scripts show you how you can directly access the binary output data for custom post-processing and plotting. However, for simple visualization tasks, the createXSF script should suffice, as we demonstrated with the electron density at the end of the <a href="FirstCalc.html">previous tutorial</a>. Now visualize the Kohn-Sham orbitals using: </p><pre class="fragment">createXSF water.out water-x.xsf water.wfns_0_x.rs
</pre><p> for each x in 0,1,2,3, and view each of the generated XSF files using VESTA to get the plots shown below and at the start of this tutorial. (You will need to change the boundary setting as in the previous tutorial.)</p>
<p>The orbitals are sorted by their corresponding energy eigenvalue. In VESTA, the yellow and cyan correspond to different signs of the plotted quantity. Note that the lowest orbital has the same sign thoughout, whereas the remaining three have symmetric positive and negative regions separated by a nodal plane (where the orbital is zero). Two of the three nodal planes are exact planes constrained by reflection symmetry of the molecule, while the third is only approximately a plane. (Which one is that?)</p>
<div class="image">
<img src="Orbitals.jpg" alt=""/>
</div>
 </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
</div>
</body>
</html>
