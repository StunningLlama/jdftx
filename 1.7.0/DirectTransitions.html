<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>JDFTx: Direct transitions</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="jdftx-55.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">JDFTx
   &#160;<span id="projectnumber">1.7.0</span>
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.svg"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('DirectTransitions.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Direct transitions </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><div class="image">
<img src="AlWannierImEps.png" alt=""/>
</div>
<p>This tutorial will introduce more complicated post-processing techniques using MLWF-based <em>ab initio</em> tight-binding models. Here, we will calculate the frequency-dependent imaginary part of the dielectric function for aluminum, accounting for direct interband transitions.</p>
<p>The simplest mechanism of light absorption in materials is the direct excitation of an electron from an occupied state to an unoccupied state, absorbing one photon. Energy conservation requires that the difference between these states equals the energy of the photon. In solids, momentum conservation implies that the initial and final state are at the same k point because photons have negligible momentum at the electronic scale. Using perturbation theory and Fermi's golden rule, we can calculate the rate of this process for a given light intensity. From this rate, we can determine the corresponding imaginary part of the dielectric function as:</p>
<p class="formulaDsp">
\[ \mathrm{Im}\epsilon(\omega) = \frac{4\pi^2 e^2}{3m_e^2\omega^2 \Omega} \int_{\mathrm{BZ}} \frac{2d\vec{k}}{V_{\mathrm{BZ}}} \sum_{n&#39;n} (f_{\vec{k}n} - f_{\vec{k}n&#39;}) \delta(\varepsilon_{\vec{k}n&#39;} - \varepsilon_{\vec{k}n} - \hbar\omega) \left| \langle\vec{p}\rangle^{\vec{k}}_{n&#39;n} \right|^2, \]
</p>
<p>where \(\Omega\) is the unit cell volume, \(\varepsilon_{\vec{k}n}\) and \(f_{\vec{k}n}\) are Kohn-Sham eigenvalues and occupations respectively, and \(\langle\vec{p}\rangle^{\vec{k}}_{n&#39;n}\) are the momentum matrix elements connecting band <em>n</em> and <em>n'</em> at Bloch wave-vector <em>k</em>. The integral averages over the Brillouin zone, and the delta function implements energy conservation. See <a href="http://dx.doi.org/10.1021/acsnano.5b06199">this paper</a> for more details; small differences here include a factor of 2 for spin degeneracy since we will use a non-relativistic calculation, and an average over spatial directions for an isotropic material that yields the factor of 3 in the denominator.</p>
<p>In the <a href="EntangledBands.html">previous tutorial</a>, we generated an <em>ab initio</em> tight-binding Hamiltonian for aluminum, which allows us to calculate the Kohn-Sham eigenvalues at arbitrary k. The occupation factors are 1 for eigenvalues smaller than mu, and 0 for those above mu. (The intermediate occupations for eigenvalues within k<sub>B</sub>T of mu contribute negligibly for optical properties.) We also output the momentum matrix elements using the saveMomenta option of the <a class="el" href="CommandWannier.html">wannier</a> command. We will now use these outputs to calculate ImEps for aluminum: </p><pre class="fragment">#Save the following to WannierImEps.py:
import numpy as np

#Read the MLWF cell map, weights and Hamiltonian:    
cellMap = np.loadtxt("wannier.mlwfCellMap")[:,0:3].astype(np.int)
Wwannier = np.fromfile("wannier.mlwfCellWeights")
nCells = cellMap.shape[0]
nBands = int(np.sqrt(Wwannier.shape[0] / nCells))
Wwannier = Wwannier.reshape((nCells,nBands,nBands)).swapaxes(1,2)
#--- Get k-point folding from totalE.out:
for line in open('totalE.out'):
    if line.startswith('kpoint-folding'):
        kfold = np.array([int(tok) for tok in line.split()[1:4]])
kfoldProd = np.prod(kfold)
kStride = np.array([kfold[1]*kfold[2], kfold[2], 1])
#--- Read reduced Wannier Hamiltonian, momenta and expand them:
Hreduced = np.fromfile("wannier.mlwfH").reshape((kfoldProd,nBands,nBands)).swapaxes(1,2)
Preduced = np.fromfile("wannier.mlwfP").reshape((kfoldProd,3,nBands,nBands)).swapaxes(2,3)
iReduced = np.dot(np.mod(cellMap, kfold[None,:]), kStride)
Hwannier = Wwannier * Hreduced[iReduced]
Pwannier = Wwannier[:,None] * Preduced[iReduced]

#Constants / calculation parameters:
mu = 0.399     #in Hartrees
eV = 1/27.2114 #in Hartrees
omegaMax = 6*eV #maximum photon energy to consider
Angstrom = 1/0.5291772 #in bohrs
aCubic = 4.05*Angstrom #in bohrs
Omega = (aCubic**3)/4  #cell volume

#Calculate ImEps by Monte-Carlo sampling of the BZ integral:
nBlocks = 100  #number of blocks
nK = 1000      #number of k per block
prefactor = 8*(np.pi**2)/(3.*Omega*nK*nBlocks) #Note me=e=hbar=1 in atomic units
omegaAll = []  #Frequencies of transitions
weightAll = [] #Corresponding weights
for iBlock in range(nBlocks):
    kpoints = np.random.rand(nK,3)         #Generate random k
    Hk = np.tensordot(np.exp((2j*np.pi)*np.dot(kpoints,cellMap.T)), Hwannier, axes=1)
    Pk = np.tensordot(np.exp((2j*np.pi)*np.dot(kpoints,cellMap.T)), Pwannier, axes=1)
    Ek,Vk = np.linalg.eigh(Hk)             #Diagonalize

    Pk = np.einsum("kba,kpbc,kcd-&gt;kpad",   #Sum using Einstein notation for
        Vk.conjugate(), Pk, Vk)            #transforming Pk to eigenbasis

    #Vectorized loop over pairs of states:
    Ei = np.repeat(Ek[:,:,np.newaxis], nBands, axis=2).flatten() #Initial energy
    Ef = np.repeat(Ek[:,np.newaxis,:], nBands, axis=1).flatten()   #Final energy
    omega = Ef - Ei                                           #Energy difference
    Psq = np.sum(np.abs(Pk)**2, axis=1).flatten()        #Matrix element squared

    sel = np.where(  #Select valid transitions:
        (Ei &lt; mu) &amp;        #initial state occupied
        (Ef &gt; mu) &amp;        #final state unoccupied
        (omega &lt; omegaMax) #energy difference in range
    )[0]
    omegaAll.append(omega[sel])
    weightAll.append(prefactor * Psq[sel] / (omega[sel]**2))
    print("Block", iBlock+1, "of", nBlocks) #Report progress

#Histogram:
nBins = 200
omegaAll = np.concatenate(omegaAll)
weightAll = np.concatenate(weightAll)
hist,binEdges = np.histogram(omegaAll, nBins, weights=weightAll, density=True)
hist *= np.sum(weightAll)  #Integral should be sum(weights), but np.histogram normalizes to 1
bins = 0.5*(binEdges[1:]+binEdges[:-1])  #bin centers
#--- Save:
outData = np.vstack((bins/eV,hist)).T #Put together in columns, converting omega to eV
np.savetxt("wannier.ImEps", outData)
</pre><p> The overall structure is quite similar to WannierDOS.py from the previous tutorial. In addition to the Hamiltonian, now we also transform the momentum matrix elements, first from MLWF to k space, and then to the Kohn-Sham eigenbasis. Then the code considers pairs of states at each k-point and finds transitions that contribute to light absorption at relevant frequencies. Finally, these transitions are histogrammed by frequency, appropriately weighted by the matrix elements, to calculate ImEps as a function of frequency.</p>
<p>Run "python WannierImEps.py" and plot the results saved to wannier.ImEps.</p>
<div class="image">
<img src="AlWannierImEps.png" alt=""/>
</div>
<p>Note the excellent agreement with experimental results (from ellipsometry measurements; Palik handbook) for high frequencies. At low frequencies, the experimental measurements are larger because they also include contributions due to intraband transitions. Additionally, the peak at 1.5 eV is sharper in theory than experiment because we did not account for carrier broadening effects. Accounting for these additional mechanisms and broadening effects results in much better agreement with experiment as shown <a href="http://dx.doi.org/10.1021/acsnano.5b06199">here</a>. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
</div>
</body>
</html>
